<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommendations</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQiM135iKHzIWyG7ybNFmF8ZNRUpRaAnaOacTSV2qvUjvsgm8q2oSftjq0HCZjmGlODC38LZKo2Fhg4/pub?output=csv')
                .then(response => response.text())
                .then(data => {
                    const recommendations = data.split('\n').slice(1).map(row => {
                        const [service, recommender, , vendor, webpage, date, liked] = row.split(',');
                        return { service, recommender, vendor, webpage, date, liked };
                    });

                    function populateDropdown() {
                        const dropdowns = document.querySelectorAll(".recommendations-dropdown");
                        dropdowns.forEach(dropdown => {
                            const uniqueServices = [...new Set(recommendations.map(row => row.service.toLowerCase()))];
                            dropdown.innerHTML = '<option value="">Select</option>';
                            uniqueServices.forEach(service => {
                                const option = document.createElement("option");
                                option.value = service;
                                option.text = service.charAt(0).toUpperCase() + service.slice(1);
                                dropdown.add(option);
                            });
                            const newServiceOption = document.createElement("option");
                            newServiceOption.value = "new-service";
                            newServiceOption.text = "New Service";
                            dropdown.add(newServiceOption);
                        });
                    }

                    function showRecommendation() {
                        const selectedOption = document.getElementById("recommendations").value;
                        const filteredRecommendations = recommendations.filter(row => row.service.toLowerCase() === selectedOption);

                        if (filteredRecommendations.length > 0) {
                            const vendors = filteredRecommendations.reduce((acc, recommendation) => {
                                if (!acc[recommendation.vendor]) {
                                    acc[recommendation.vendor] = {
                                        webpage: recommendation.webpage,
                                        recommenders: []
                                    };
                                }
                                acc[recommendation.vendor].recommenders.push(`${recommendation.recommender} (${recommendation.date})`);
                                return acc;
                            }, {});

                            const vendorList = Object.keys(vendors).map(vendor => `
                                <p><strong>Vendor:</strong> ${vendors[vendor].webpage ? `<a href="${vendors[vendor].webpage}" target="_blank">${vendor}</a>` : vendor}</p>
                                <p><strong>Number of Recommenders:</strong> ${vendors[vendor].recommenders.length}</p>
                                <p><strong>Recommenders:</strong> ${vendors[vendor].recommenders.join(', ')}</p>
                            `).join('');

                            document.getElementById("result").innerHTML = vendorList;
                        } else {
                            document.getElementById("result").innerHTML = `<p>No recommendation found.</p>`;
                        }
                    }

                    function showRecommendationForm() {
                        const selectedOption = document.getElementById("recommendations-recommend").value;
                        if (selectedOption === "new-service") {
                            document.getElementById("new-service-input").style.display = "block";
                        } else {
                            document.getElementById("new-service-input").style.display = "none";
                        }
                        if (selectedOption) {
                            document.getElementById("recommendation-form").style.display = "block";
                        } else {
                            document.getElementById("recommendation-form").style.display = "none";
                        }
                    }

                    function addRecommendation() {
                        const serviceDropdown = document.getElementById("recommendations-recommend");
                        const service = serviceDropdown.value === "new-service" ? document.getElementById("new-service").value : serviceDropdown.value;
                        const recommender = document.getElementById("recommender").value;
                        const vendorName = document.getElementById("vendor-name").value;
                        const vendorWebsite = document.getElementById("vendor-website").value;
                        const date = document.getElementById("date").value;
                        const comments = document.getElementById("comments").value;

                        // Add the new recommendation to the recommendations table
                        recommendations.push({
                            service: service.charAt(0).toUpperCase() + service.slice(1),
                            recommender: recommender,
                            vendor: vendorName,
                            webpage: vendorWebsite,
                            date: date,
                            liked: comments
                        });

                        // Repopulate the dropdowns to include the new service if it's unique
                        populateDropdown();

                        // Add the new recommendation to the Google Sheets
                        const newRow = `${service},${recommender},,${vendorName},${vendorWebsite},${date},${comments}\n`;
                        fetch('https://docs.google.com/forms/d/e/1FAIpQLSdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdfgdf

